(()=>{"use strict";var e=document.querySelector(".popup_type_photo"),t=document.querySelector(".profile__photo"),n=document.querySelector(".popup__close-button_type_photo"),o=document.querySelector(".popup__input_type_photo"),c=document.querySelector("#popup__form_type_photo"),r=document.querySelector(".popup_type_profile"),u=document.querySelector(".profile__edit-button"),i=document.querySelector(".popup__close-button_type_profile"),a=document.querySelector(".popup__input_type_name"),l=document.querySelector(".popup__input_type_quote"),s=document.querySelector(".profile__name"),d=document.querySelector(".profile__quote"),p=document.querySelector(".elements__list"),_=document.querySelector("#elements__template").content,f=document.querySelector(".popup_type_card-add"),m=document.querySelector(".profile__add-button"),y=document.querySelector(".popup__close-button_type_card-add"),h=document.querySelector(".popup__input_type_image"),v=document.querySelector(".popup__input_type_title"),S=document.querySelector("#popup__form_type_card-add"),q=document.querySelector(".popup_type_picture"),b=document.querySelector(".popup__close-button_type_picture"),E=document.querySelector(".image__pic"),L=document.querySelector(".image__title"),k="elements__like-button_active",g={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"bb5f0ee9-ef64-4836-93fe-6fc2439d86be","Content-Type":"application/json"}},C=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status+" - "+e.statusText))},x=function(){return fetch("".concat(g.baseUrl,"/users/me"),{headers:g.headers}).then(C)},U=function(e,t){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(e),{method:t,headers:g.headers}).then(C)};function T(e){e.classList.add("popup_opened"),document.addEventListener("mousedown",w),document.addEventListener("keydown",D)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("mousedown",w),document.removeEventListener("keydown",D)}var D=function(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))},w=function(e){e.target.classList.contains("popup")&&A(e.target)};function P(e){var t,n,o=_.querySelector(".elements__cell").cloneNode(!0),c=o.querySelector(".elements__image"),r=o.querySelector(".elements__name");return c.src=e.link,c.alt="Фото "+e.name,r.textContent=e.name,"c0c6ac37cc305347921373a8"!=e.owner._id&&(o.querySelector(".elements__delete-button").style.display="none"),function(e,t){t.querySelector(".elements__delete-button").addEventListener("click",(function(){var n;(n=e._id,fetch("".concat(g.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:g.headers}).then(C)).then((function(){t.remove()})).catch((function(e){console.log(e)}))}))}(e,o),function(e,t){var n=t.querySelector(".elements__like-counter"),o=t.querySelector(".elements__like-button");n.textContent=e.likes.length.toString(),e.likes.some((function(e){return"c0c6ac37cc305347921373a8"==e._id}))&&o.classList.add(k),o.addEventListener("click",(function(){o.classList.contains(k)?U(e._id,"DELETE").then((function(t){o.classList.remove(k),e.likes=t.likes,n.textContent=t.likes.length.toString()})).catch((function(e){console.log(e)})):U(e._id,"PUT").then((function(t){o.classList.add(k),e.likes=t.likes,n.textContent=t.likes.length.toString()})).catch((function(e){console.log(e)}))}))}(e,o),t=e.name,n=e.link,o.querySelector(".elements__image").addEventListener("click",(function(){T(q),E.src=n,E.alt="Фото "+t,L.textContent=t})),o}var N=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1};function O(e,t){var n=t.querySelector(".popup__submit-button");e&&(n.textContent="Сохранение...")}x().then((function(e){console.log(e),t.src=e.avatar,s.textContent=e.name,d.textContent=e.about})).catch((function(e){console.log(e)})),fetch("".concat(g.baseUrl,"/cards"),{headers:g.headers}).then(C).then((function(e){console.log(e),e.forEach((function(e){p.append(P(e))}))})).catch((function(e){console.log(e)})),b.addEventListener("click",(function(){A(q)})),t.addEventListener("click",(function(){T(e)})),n.addEventListener("click",(function(){A(e)})),e.addEventListener("submit",(function(n){var r;n.preventDefault(),O(!0,e),A(e),r=o,fetch("".concat(g.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:g.headers,body:JSON.stringify({avatar:r.value})}).then(C),x().then((function(e){t.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)})),c.reset()})),u.addEventListener("click",(function(){a.value=s.textContent,l.value=d.textContent,T(r)})),i.addEventListener("click",(function(){A(r)})),r.addEventListener("submit",(function(e){var t,n;e.preventDefault(),O(!0,r),A(r),t=a,n=l,fetch("".concat(g.baseUrl,"/users/me"),{method:"PATCH",headers:g.headers,body:JSON.stringify({name:t.value,about:n.value})}).then(C),x().then((function(e){s.textContent=e.name,d.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){O(!1,r)}))})),m.addEventListener("click",(function(){T(f)})),y.addEventListener("click",(function(){A(f)})),f.addEventListener("submit",(function(e){var t,n;e.preventDefault(),O(!0,f),A(f),(t=v,n=h,fetch("".concat(g.baseUrl,"/cards"),{method:"POST",headers:g.headers,body:JSON.stringify({name:t.value,link:n.value})}).then(C)).then((function(e){p.prepend(P(e))})).catch((function(e){console.log(e)})).finally((function(){O(!1,f)})),S.reset()})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){e.addEventListener("submit",(function(e){e.preventDefault(),o.disabled=!0}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.buttonSelector);n.forEach((function(e){e.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){document.querySelector("#".concat(e.name,"-error")).textContent="",e.classList.remove(t.inputErrorClass)}(e,t):function(e,t){document.querySelector("#".concat(e.name,"-error")).textContent=e.validationMessage,e.classList.add(t.inputErrorClass)}(e,t)})(e,t),N(o,n)})),N(o,n)}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",buttonSelector:".popup__submit-button",inputErrorClass:"popup__input_error"})})();